<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Kiara Optometry Lens Selector</title>
<meta name="viewport" content="width=device-width, initial-scale=0.8" />

<style>
:root{
  --green:#0b3d2e;
  --pale:#ffffe0;
  --off:#f8f8f5;
  --line:#d7d7cf;
  --btn-bg:#0b3d2e;
  --btn-text:#ffffe0;
  --btn-border:#ffffff;
}
td.na {
  color: #999;
  font-style: italic;
}


/* Visually hidden helper */
.search-only{
  position:absolute;
  width:1px;
  height:1px;
  overflow:hidden;
  white-space:nowrap;
  clip:rect(0 0 0 0);
}

/* Base */
html,body{
  background:var(--off);
  color:var(--green);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  font-size:11px;
  margin:0;
}

/* Page wrapper */
.wrap{ width:90%; max-width:600px; margin:0 auto; padding:12px 0; }

/* Card sections */
.section{
  background:var(--pale);
  border:1px solid var(--line);
  border-radius:10px;
  padding:12px;
  margin:10px 0;
}

/* Lightbox overlay */
#lightboxOverlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
#lightboxOverlay img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 5px;
  box-shadow: 0 0 20px #000;
  transition: transform 0.3s;
}
#lightboxOverlay:hover { cursor: pointer; }

/* Lens container (unused in this page but kept for consistency) */
.lens-container {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}
.sectionlens {
  background:var(--pale);
  border:1px solid var(--line);
  border-radius:10px;
  padding:12px;
  cursor: pointer;
  overflow: hidden;
}
h4{
font-size:13px;
padding:0 0 0 0;
margin:30px 0 0 0 ;
font-weight:700;
}

h5{
font-size:11px;
padding:0 0 0 0;
margin:0 0 2px 0 ;
font-weight:500;
text-decoration: italic;
}



.sectionlens img { width:100%; height:auto; display:block; }

/* Form controls */
label{ font-weight:600; margin-top:8px; display:block; }
input, textarea { width:100%; padding:6px; border:1px solid #c9c9c1; border-radius:6px; box-sizing:border-box; }
textarea{ min-height:40px; resize:vertical; }

button.normal{
  background:var(--btn-bg);
  color:var(--btn-text);
  border:1px solid var(--btn-border);
  padding:6px 14px;
  border-radius:7px;
  font-size:11px;
  width:150px;
  cursor:pointer;
  margin:0 8px 8px 0;
}
button.small{
  background:var(--btn-bg);
  color:var(--btn-text);
  border:1px solid var(--btn-border);
  padding:6px 10px;
  border-radius:7px;
  font-size:11px;
  width:15%;
  cursor:pointer;
  margin:0 8px 5px 0;
}
button:hover{ filter:brightness(1.05); }
button:active{ transform:translateY(1px); }

/* Typography */
h2{ text-align:center; margin:10px 0; font-size:18px; color:var(--green); }
.row{ display:flex; flex-direction:column; gap:6px; margin-top:8px; }

/* Enforce small text inside sections (except headings) */
.section *:not(h1):not(h2):not(h3):not(h4):not(h5):not(h6){ font-size:11px; }

/* Table styling and layout */
.table-wrapper { max-width:90%; margin:0 auto; }
table {
  border-collapse: collapse;
  width: 90%;
  table-layout: fixed;
  background: #ffffe0;
  border:none;
}
th, td {
  padding: 3px;
  text-align: center;
  position: relative;
  border:none;
  background: #ffffe0;
  height:5px;
}

/* Column widths: first column 25%, remaining share 75% equally (5 columns -> 15% each) */
th:nth-child(1), td:nth-child(1) { width:15%; }
th:nth-child(n+2), td:nth-child(n+2) { width:20%; }

/* Masking (applies to tr, th, td) */
tr.masked td,
td.masked,
th.masked {
  color: transparent;
  position: relative;
}
tr.masked td::after,
td.masked::after,
th.masked::after {
  content: '';
  position: absolute;
  inset: 0;
  background: #ffffe0;
}
.flex-row {
  display: flex;
  gap: 12px;
}
.flex-item {
  flex: 1; /* equal width */
  display: flex;
  flex-direction: column;
}
.controls { margin-bottom:8px; }
.controls button { margin-right:6px; }
</style>
</head>

<body>

<div style="height:20px"></div>

<div class="wrap">

  <h2>Kiara Optometry Lens Selector</h2>

  <div class="section">
    <h3>Wearer's Details</h3>
    <label>Name</label>
    <input id="name" type="text">

    <label>WhatsApp Number - <i>With country code, e.g. 601170199170</i></label>
    <input id="phone" type="text" placeholder="">

    <label>Notes</label>
    <textarea id="msg"></textarea>

    <div style="margin-top:8px;">
      <button class="normal" id="greetBtn">Greetings</button>
      <button class="normal" id="sendBtn">Send WhatsApp</button>
    </div>
  </div>


  <div class="section">
    <h3>Lens Price</h3>
    <div>
      <b>Index : Low - Median - High</b><br>
      1.56 : RM 250 – 480 to 700 – 2,600<br>
      1.61 : RM 380 – 550 to 900 – 3,150<br>
      1.67 : RM 530 – 650 to 1,450 – 3,550<br>
      1.74 : RM 750 – 880 to 2,100 – 4,850<br><br>
      ----------
    </div><br>

    <span><b>Price Calculator</b></span><br><br>
    <input id="priceInput" type="number" placeholder="Price 1 e.g. Frame" style="margin-bottom:6px;">
    <input id="input2" type="number" placeholder="Price 2 e.g. Lens" style="margin-bottom:6px;">
    <input id="input3" type="number" placeholder="Price 3 e.g. Lens Extra" style="margin-bottom:6px;">

    <div style="margin-top:8px;">
      <button class="normal" onclick="calculateStandardDiscount()">Discount</button>
      <button class="normal" onclick="calculateNoExamDiscount()">No Eye Exam Price</button>
      <button class="normal" style="background-color:maroon" id="rCodeBtn" onclick="applyRCode()">R-Code</button>
    </div>

    <div id="output" style="font-weight:bold; margin-top:8px;"></div>
    <div id="dateOutput" style="font-weight:bold;"></div>

  </div>


<div class="section">
  <h3>What Index Is Suitable?</b> - Key in your sphere and cyl power to get an estimate</h3>
  <div class="flex-row">
    <div class="flex-item">
      <label>Sphere</label>
      <input id="sph" type="text" step="0.25">
    </div>
    <div class="flex-item">
      <label>Cylinder</label>
      <input id="cyl" type="text" step="0.25">
    </div>
  </div>

  <div style="margin-top:8px; display:flex; align-items:center; gap:8px;">
    <button class="normal" id="recommendBtn">Recommended Index</button>
    <span id="indexResult" style="font-weight:bold;"></span>
  </div>
<br>
----------<br><br>
   <div class="controls">
    <span><b>Lens Filter</b></span><br><br>
      <button class="small" onclick="toggleMask('idx-156')">1.56</button>
      <button class="small" onclick="toggleMask('idx-160')">1.60</button>
      <button class="small" onclick="toggleMask('idx-167')">1.67</button>
      <button class="small" onclick="toggleMask('idx-174')">1.74</button>
      <button class="small" onclick="toggleMask('mask-polar-sun')">Polar & Tint</button>
    </div>


</div>


<!-- Price matrix -->
<div class="section">


<div class="wrap">

<div style="display:none">
  <h4>Example</h4>
  <h5>Description</h5>
<div class="example-wrapper" style="display: flex; align-items: flex-start; gap: 20px;">
  <!-- Image on the left -->
  <div class="image-container">
    <img src="your-image.jpg" alt="Example Image" style="max-width: 150px;">
  </div>


  <div class="table-wrapper">
    <table id="example">
      <thead>
        <tr>
          <th>Index</th>
          <th>UV400</th>
          <th>UV420</th>
          <th>Photochromic</th>
          <th class="mask-polar-sun">Polar</th>
          <th class="mask-polar-sun">Sunglasses</th>
        </tr>
      </thead>
      <tbody>
        <tr class="idx-156">
          <th>1.56</th>
          <td data-index="1.56" data-treatment="UV400"></td>
          <td data-index="1.56" data-treatment="UV420"></td>
          <td data-index="1.56" data-treatment="Photochromic"></td>
          <td data-index="1.56" data-treatment="Polarized" class="mask-polar-sun"></td>
          <td data-index="1.56" data-treatment="Sunglasses" class="mask-polar-sun"></td>
        </tr>
        <tr class="idx-160">
          <th>1.60</th>
          <td data-index="1.60" data-treatment="UV400"></td>
          <td data-index="1.60" data-treatment="UV420"></td>
          <td data-index="1.60" data-treatment="Photochromic"></td>
          <td data-index="1.60" data-treatment="Polarized" class="mask-polar-sun"></td>
          <td data-index="1.60" data-treatment="Sunglasses" class="mask-polar-sun"></td>
        </tr>
        <tr class="idx-167">
          <th>1.67</th>
          <td data-index="1.67" data-treatment="UV400"></td>
          <td data-index="1.67" data-treatment="UV420"></td>
          <td data-index="1.67" data-treatment="Photochromic"></td>
          <td data-index="1.67" data-treatment="Polarized" class="mask-polar-sun"></td>
          <td data-index="1.67" data-treatment="Sunglasses" class="mask-polar-sun"></td>
        </tr>
        <tr class="idx-174">
          <th>1.74</th>
          <td data-index="1.74" data-treatment="UV400"></td>
          <td data-index="1.74" data-treatment="UV420"></td>
          <td data-index="1.74" data-treatment="Photochromic"></td>
          <td data-index="1.74" data-treatment="Polarized" class="mask-polar-sun"></td>
          <td data-index="1.74" data-treatment="Sunglasses" class="mask-polar-sun"></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
</div>

  <h4>Rayfilter Basic - 3 days</h4>
  <h5>Made in Taiwan, mid-range value for money</h5>
<div>
  <hr>
</div>

<div class="example-wrapper" style="display: flex; align-items: flex-start; gap: 20px;">
  <!-- Image square -->
  <div class="image-container" style="width: 100px; height: 100px; flex-shrink: 0;">
    <img src="https://github.com/kiaraoptometrypx/OL-selector/raw/main/Driving_View.png" 
         alt="Driving View" 
         style="width: 100%; height: 100%; object-fit: cover;">
  </div>




  <div class="table-wrapper">
    <table id="brandA">
      <thead>
        <tr>
          <th>Index</th>
          <th>UV400</th>
          <th>UV420</th>
          <th>Photochromic</th>
          <th class="mask-polar-sun">Polar</th>
          <th class="mask-polar-sun">Sunglasses</th>
        </tr>
      </thead>
      <tbody>
        <tr class="idx-156">
          <th>1.56</th>
          <td data-index="1.56" data-treatment="UV400"></td>
          <td data-index="1.56" data-treatment="UV420"></td>
          <td data-index="1.56" data-treatment="Photochromic"></td>
          <td>-</td>
          <td>-</td>
        </tr>
        <tr class="idx-160">
          <th>1.60</th>
          <td data-index="1.60" data-treatment="UV400"></td>
          <td data-index="1.60" data-treatment="UV420"></td>
          <td data-index="1.60" data-treatment="Photochromic"></td>
          <td>-</td>
          <td>-</td>
        </tr>
        <tr class="idx-167">
          <th>1.67</th>
          <td data-index="1.67" data-treatment="UV400"></td>
          <td data-index="1.67" data-treatment="UV420"></td>
          <td data-index="1.67" data-treatment="Photochromic"></td>
          <td>-</td>
          <td>-</td>
        </tr>
        <tr class="idx-174">
          <th>1.74</th>
          <td>-</td>
          <td data-index="1.74" data-treatment="UV420"></td>
          <td data-index="1.74" data-treatment="Photochromic"></td>
          <td>-</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>



  <h4>Rayfilter Premium</h4>
  <h5>Made in Taiwan, mid-range value for money</h5>

  <div class="table-wrapper">
    <table id="rayfilterpremium">
      <thead>
        <tr>
          <th>Index</th>
          <th>UV400</th>
          <th>UV420</th>
          <th>Photochromic</th>
          <th class="mask-polar-sun">Polar</th>
          <th class="mask-polar-sun">Sunglasses</th>
        </tr>
      </thead>
      <tbody>
        <tr class="idx-156">
          <th>1.56</th>
          <td>-</td>
          <td data-index="1.56" data-treatment="UV420"></td>
          <td data-index="1.56" data-treatment="Photochromic"></td>
          <td>-</td>
          <td>-</td>
        </tr>
        <tr class="idx-160">
          <th>1.60</th>
          <td data-index="1.60" data-treatment="UV400"></td>
          <td data-index="1.60" data-treatment="UV420"></td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        </tr>
        <tr class="idx-167">
          <th>1.67</th>
          <td data-index="1.67" data-treatment="UV400"></td>
          <td data-index="1.67" data-treatment="UV420"></td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        </tr>
        <tr class="idx-174">
          <th>1.74</th>
          <td>-</td>
          <td data-index="1.74" data-treatment="UV420"></td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

</div>
<div style="height:200px"></div>



<script>
/* ========= BRAND CONFIG ========= */
const BRANDS = {
  brandA: {
    base: 250,
    indexAdd: { "1.56":0, "1.60":150, "1.67":300, "1.74":500 },
    treatmentAdd: { UV400:0, UV420:80, Photochromic:300, Polarized:200, Sunglasses:150 }
  },
  rayfilterpremium: {
    base: 280,
    indexAdd: { "1.56":0, "1.60":120, "1.67":250, "1.74":450 },
    treatmentAdd: { UV400:0, UV420:90, Photochromic:320, Polarized:210, Sunglasses:160 }
  }

};

/* ========= FILL PRICES ========= */
Object.entries(BRANDS).forEach(([id, cfg]) => {
  document.querySelectorAll(`#${id} td[data-index]`).forEach(td => {
    const idx = td.dataset.index;
    const treatment = td.dataset.treatment;
    const idxAdd = cfg.indexAdd[idx] ?? 0;
    const treatAdd = cfg.treatmentAdd[treatment] ?? 0;
    td.textContent = Math.round(cfg.base + idxAdd + treatAdd);
  });
});
</script>


<script>

/* ========= MASK FUNCTION (reusable) ========= */
function toggleMask(cls){
  document.querySelectorAll('.' + cls).forEach(el=>{
    el.classList.toggle('masked');
  });
}

/* ========= Lightbox helpers ========= */
function openLightbox(src) {
  const overlay = document.getElementById('lightboxOverlay');
  const img = document.getElementById('lightboxImg');
  img.src = src;
  overlay.style.display = 'flex';
}
function closeLightbox() {
  document.getElementById('lightboxOverlay').style.display = 'none';
  document.getElementById('lightboxImg').src = '';
}

/* ========= Search (for .sectionlens elements) ========= */
(function() {
  const searchInput = document.getElementById("searchInput");
  if (!searchInput) return;
  const sections = document.querySelectorAll(".sectionlens");
  searchInput.addEventListener("input", () => {
    const terms = searchInput.value.toLowerCase().split(/\s+/).filter(Boolean);
    sections.forEach(section => {
      const text = section.textContent.toLowerCase();
      const match = terms.every(term => text.includes(term));
      section.style.display = match ? "block" : "none";
    });
  });
})();

/* ========= Public holidays + delivery estimate ========= */
const PUBLIC_HOLIDAYS = new Set([
  "2025-01-01","2025-01-29","2025-01-30","2025-02-01","2025-02-03",
  "2025-02-11","2025-03-18","2025-03-31","2025-04-01","2025-05-01",
  "2025-05-12","2025-06-02","2025-06-07","2025-06-27","2025-08-31",
  "2025-09-01","2025-09-05","2025-09-15","2025-09-16","2025-10-20",
  "2025-12-11","2025-12-25","2026-01-01","2026-02-01","2026-02-02",
  "2026-02-17","2026-02-18","2026-03-07","2026-03-21","2026-03-22",
  "2026-03-23","2026-05-01","2026-05-27","2026-05-31","2026-06-01",
  "2026-06-17","2026-08-25","2026-08-31","2026-09-16","2026-11-08",
  "2026-11-09","2026-12-11","2026-12-25"
]);
const DAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
function getOrdinal(n) { let s=["th","st","nd","rd"], v=n%100; return n + (s[(v-20)%10]||s[v]||s[0]); }
function addWorkingDays(date, days) {
  let result = new Date(date);
  while (days > 0) {
    result.setDate(result.getDate() + 1);
    let day = result.getDay();
    let dateStr = result.toISOString().split('T')[0];
    if (day !== 0 && day !== 6 && !PUBLIC_HOLIDAYS.has(dateStr)) days--;
  }
  return result;
}
function formatDateWithDay(d) {
  const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  return `${getOrdinal(d.getDate())} ${months[d.getMonth()]} ${DAYS[d.getDay()]}`;
}
function calculateWorkingDays() {
  let today = new Date();
  let threeDays = addWorkingDays(today, 3);
  let sevenDays = addWorkingDays(today, 7);
  document.getElementById('dateOutput').innerHTML = `
    Today is ${formatDateWithDay(today)}.<br>
    3 Days Completion Estimate : ${formatDateWithDay(threeDays)}.<br>
    7 Days Completion Estimate : ${formatDateWithDay(sevenDays)}.
  `;
}
calculateWorkingDays();

/* ========= Greeting & WhatsApp ========= */
document.getElementById("greetBtn").onclick = () => {
  const name = document.getElementById("name").value.trim();
  document.getElementById("msg").value = `Greetings ${name} from Kiara Optometry.`;
};
document.getElementById("sendBtn").onclick = () => {
  const phone = document.getElementById("phone").value.replace(/\D/g,'');
  const text = encodeURIComponent(document.getElementById("msg").value);
  if (!phone || !text) return;
  window.open(`https://wa.me/${phone}?text=${text}`, "_blank");
};

/* ========= Index recommendation ========= */
document.getElementById("recommendBtn").onclick = () => {
  const sph = parseFloat(document.getElementById("sph").value) || 0;
  const cyl = parseFloat(document.getElementById("cyl").value) || 0;
  const total = Math.abs(sph) + Math.abs(cyl);
  const lensMap = [
    {min: 0.00, max: 4.00, index: "1.56"},
    {min: 4.00, max: 6.00, index: "1.61"},
    {min: 6.00, max: 8.00, index: "1.67"},
    {min: 8.00, max: Infinity, index: "1.74"}
  ];
  let rec = lensMap.find(item => total > item.min && total <= item.max) || lensMap[0];
  let midpoint = (rec.min + (rec.max === Infinity ? rec.min + 4 : rec.max)) / 2;
  let thicknessDesc = total <= midpoint ? "thinner side" : "thicker side";
  document.getElementById("indexResult").textContent =
    `${rec.index} ; RX is on ${thicknessDesc} of this index. RX range ${rec.min.toFixed(2)} to ${rec.max === Infinity ? '∞' : rec.max.toFixed(2)}.`;
};

/* ========= Discounts & R-Code ========= */
function formatRM(amount) { return 'RM ' + Math.round(amount).toLocaleString(); }

function calculateStandardDiscount() {
  let p1 = parseFloat(document.getElementById('priceInput').value) || 0;
  let p2 = parseFloat(document.getElementById('input2').value) || 0;
  let p3 = parseFloat(document.getElementById('input3').value) || 0;
  let price = p1 + p2 + p3;
  if (price <= 0) { document.getElementById('output').innerHTML = '<br><em>Please enter price.</em>'; return; }
  let discount = 0;
  if (price <= 249) discount = 0;
  else if (price <= 299) discount = 10;
  else if (price <= 699) discount = 15;
  else discount = 20;
  let netPrice = price * (1 - discount / 100);
  document.getElementById('output').innerHTML = `<br>
    Original Price : ${formatRM(price)}<br>
    Net Price : ${formatRM(netPrice)}<br>
    ${discount > 0 ? `Description : ${discount}% off until March 2026!<br>` : ``}
  `;
}

function calculateNoExamDiscount() {
  let p1 = parseFloat(document.getElementById('priceInput').value) || 0;
  let p2 = parseFloat(document.getElementById('input2').value) || 0;
  let p3 = parseFloat(document.getElementById('input3').value) || 0;
  let price = p1 + p2 + p3;
  if (price <= 0) { document.getElementById('output').innerHTML = '<br><em>Please enter price.</em>'; return; }
  let discount = 30;
  let netPrice = price * (1 - discount / 100);
  if (netPrice < 200) netPrice = 200;
  document.getElementById('output').innerHTML = `<br>
    Original Price : ${formatRM(price)}<br>
    No-Eye-Exam Net Price : ${formatRM(netPrice)}<br>
  `;
}

function applyRCode() {
  let p1 = parseFloat(document.getElementById('priceInput').value) || 0;
  let p2 = parseFloat(document.getElementById('input2').value) || 0;
  let p3 = parseFloat(document.getElementById('input3').value) || 0;
  let price = p1 + p2 + p3;
  if (price <= 0) { document.getElementById('output').innerHTML = '<br><em>Please enter price.</em>'; return; }
  let discount = 0;
  if (price <= 249) discount = 0;
  else if (price <= 299) discount = 10;
  else if (price <= 699) discount = 15;
  else discount = 20;
  discount += 5; // R-Code extra
  let netPrice = price * (1 - discount / 100);
  document.getElementById('output').innerHTML = `<br>
    Original Price : ${formatRM(price)}<br>
    Net Price : ${formatRM(netPrice)}<br>
    ${discount > 0 ? `Description : ${discount}% off (<span style="color:red; font-weight:bold;">R-Code!</span>)<br>` : ``}
  `;
}
</script>

</body>
</html>
