<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Lens Selector</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --green:#0b3d2e;
    --pale:#ffffe0;
    --off:#f8f8f5;
    --line:#d7d7cf;
  }
  html,body{background:var(--off); color:var(--green); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; font-size:12px; line-height:1.35; margin:0}
  h1{font-size:12px; text-align:center; margin:12px 0 8px}
  h3{font-size:12px; margin:0 0 8px}
  .wrap{max-width:600px; margin:0 auto; padding:12px}
  .section{background:var(--pale); border:1px solid var(--line); border-radius:10px; padding:12px; margin:10px 0}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  label{font-weight:600}
  input[type="text"], input[type="number"], textarea{
    font-size:10px; padding:6px 8px; border:1px solid #c9c9c1; border-radius:6px; background:#fff; color:var(--green)
  }
  textarea{min-height:48px; width:100%}
  .field{display:flex; flex-direction:column; gap:4px}
  .field.inline{flex-direction:row; align-items:center; gap:6px}
  .field.w150{width:150px}
  .field.w70{width:70px}
  .rx table{width:100%; border-collapse:collapse}
  .rx th,.rx td{border:1px solid var(--line); padding:6px; text-align:center}
  .rx th{background:#e8e8dd; font-weight:700}
  .options{display:flex; flex-wrap:wrap; gap:14px}
  .options label{font-weight:400; display:inline-flex; align-items:center; gap:6px; cursor:pointer}
  .muted{opacity:.8}
  .note{font-style:italic; opacity:.8}
  button{
    background:var(--green); color:var(--pale); border:0; padding:8px 12px; border-radius:8px; cursor:pointer; font-size:12px; font-weight:700
  }
  .results table{width:100%; border-collapse:collapse}
  .results th,.results td{border:1px solid var(--line); padding:6px; text-align:left}
  .results th{background:#e8e8dd}
  .logoCell{width:52px}
  .badge{display:inline-block; padding:2px 6px; border-radius:6px; border:1px solid var(--green); margin-left:6px}
  .hidden{display:none}
  .help{margin-top:6px}
  .tiny{font-size:11px; opacity:.9}

/* Prescription table */
table input {
  width: 60px;
  text-align: center;
  font-size: 10px;
}
table {
  width: auto;
  margin: auto;
}
</style>
</head>
<body>

<div class="wrap">
  <h1>Lens Selector</h1>

  <!-- Customer info -->
  <div class="section">
    <h3>Customer</h3>
    <div class="row">
      <div class="field w150"><label for="custName">Name</label><input id="custName" type="text" placeholder="e.g. Aisyah Tan" /></div>
      <div class="field w150"><label for="custWhatsApp">WhatsApp</label><input id="custWhatsApp" type="text" placeholder="+60…" /></div>
      <div class="field w70"><label for="custPD">Total PD</label><input id="custPD" type="text" placeholder="62" /></div>
      <div class="field w70"><label for="lensSize">Lens Size</label><input id="lensSize" type="text" placeholder="50" /></div>
      <div class="field w70"><label for="bridge">Bridge</label><input id="bridge" type="text" placeholder="18" /></div>
    </div>
  </div>

  <!-- Prescription -->
  <div class="section rx">
    <h3>Prescription</h3>
    <table>
      <thead>
        <tr><th>Side</th><th>Sph</th><th>Cyl</th><th>Axis</th><th>ADD</th><th>Max RX</th></tr>
      </thead>
      <tbody>
        <tr>
          <td>Right</td>
          <td><input id="sph-od" type="text" class="rx-sph" placeholder="0.00" /></td>
          <td><input id="cyl-od" type="text" class="rx-cyl" placeholder="0.00" /></td>
          <td><input id="axis-od" type="text" class="rx-axis" placeholder="0" /></td>
          <td><input id="add-od" type="text" placeholder="0.00" /></td>
          <td><input id="max-od" type="text" readonly /></td>
        </tr>
        <tr>
          <td>Left</td>
          <td><input id="sph-os" type="text" class="rx-sph" placeholder="0.00" /></td>
          <td><input id="cyl-os" type="text" class="rx-cyl" placeholder="0.00" /></td>
          <td><input id="axis-os" type="text" class="rx-axis" placeholder="0" /></td>
          <td><input id="add-os" type="text" placeholder="0.00" /></td>
          <td><input id="max-os" type="text" readonly /></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Lead time -->
  <div class="section">
    <h3>Lead Time</h3>
    <div class="options" id="q-lead">
      <label><input type="checkbox" name="lead" value="Ready-made"> Ready-made lenses (1–3 days)</label>
      <label><input type="checkbox" name="lead" value="Custom-made"> Custom-made (7–10 days)</label>
    </div>
  </div>

  <!-- Lens Type -->
  <div class="section">
    <h3>Lens Type</h3>
    <div class="options" id="q-type">
      <label><input type="checkbox" name="type" value="Single Focal Lens"> Single Focal Lens</label>
      <label><input type="checkbox" name="type" value="Multi-focal Lens"> Multi-focal Lens</label>
      <label><input type="checkbox" name="type" value="Office Multi-focal Lens"> Office Multi-focal Lens</label>
      <label><input type="checkbox" name="type" value="Near Relaxed Lens"> Near Relaxed Lens</label>
    </div>
  </div>

  <!-- Index -->
  <div class="section">
    <h3>Index</h3>
    <div class="options" id="q-index">
      <label><input type="checkbox" name="index" value="1.50"> 1.50 <span class="tiny">(Range: +2.00 to -3.00)</span><span id="badge-1.50" class="badge muted tiny"></span></label>
      <label><input type="checkbox" name="index" value="1.61"> 1.61 <span class="tiny">(Range: +4.00 to -6.00)</span><span id="badge-1.61" class="badge muted tiny"></span></label>
      <label><input type="checkbox" name="index" value="1.67"> 1.67 <span class="tiny">(Range: +5.00 to -8.00)</span><span id="badge-1.67" class="badge muted tiny"></span></label>
      <label><input type="checkbox" name="index" value="1.74"> 1.74 <span class="tiny">(Range: +7.00 to -12.00)</span><span id="badge-1.74" class="badge muted tiny"></span></label>
    </div>
    <div class="help tiny">Higher percent = thicker lens.</div>
  </div>

  <!-- Coating -->
  <div class="section">
    <h3>Coating</h3>
    <div class="options" id="q-coating">
      <label><input type="checkbox" name="coat" value="Normal UV blocker"> Normal UV blocker</label>
      <label><input type="checkbox" name="coat" value="Normal Blue Light Filter"> Normal Blue Light Filter</label>
      <label><input type="checkbox" name="coat" value="Enhance vision in low light"> Enhance vision in low light</label>
      <label><input type="checkbox" name="coat" value="Low reflection coating"> Low reflection coating</label>
      <label><input type="checkbox" name="coat" value="Durability coating"> Durability coating</label>
    </div>
  </div>

  <!-- Photochromic -->
  <div class="section">
    <h3>Photochromic Ability</h3>
    <div class="options" id="q-photo">
      <label><input type="checkbox" name="photo" value="No"> No</label>
      <label><input type="checkbox" name="photo" value="Normal"> Normal</label>
      <label><input type="checkbox" name="photo" value="Extra Dark"> Extra Dark</label>
      <label><input type="checkbox" name="photo" value="Extra Fast"> Extra Fast</label>
    </div>
  </div>

  <!-- Optical Design -->
  <div class="section">
    <h3>Optical Design</h3>
    <div class="options" id="q-design">
      <label><input type="checkbox" name="design" value="Everyday quality"> Everyday quality</label>
      <label><input type="checkbox" name="design" value="Custom Common Optics"> Custom Common Optics</label>
      <label><input type="checkbox" name="design" value="Custom Enhanced Optical calculation"> Custom Enhanced Optical calculation</label>
    </div>
  </div>

  <!-- Results Table (without Logo) -->
<div class="section results">
  <h3>Results</h3>
  <table id="resultsTable">
    <thead>
      <tr>
        <th>Brand</th><th>Model</th><th>Index</th>
        <th>Coating</th><th>Photochromic</th><th>Optical Design</th>
        <th>Price</th><th>Description</th>
      </tr>
    </thead>
    <tbody id="resultsBody">
      <tr><td colspan="8" class="muted">No results yet — click “Show Results”.</td></tr>
    </tbody>
  </table>
</div>


</div>

<script>
// === Prescription helpers ===
function snapQuarter(value){
  if(value === "" || isNaN(parseFloat(value))) return 0;
  let num = parseFloat(value);
  return Math.round(num * 4) / 4;
}
function formatSigned(num){return (num>=0?"+":"")+num.toFixed(2);}
function updateMaxPower(eye){
  let sph=document.getElementById(`sph-${eye}`),
      cyl=document.getElementById(`cyl-${eye}`),
      axis=document.getElementById(`axis-${eye}`),
      max=document.getElementById(`max-${eye}`);
  let s=snapQuarter(sph.value), c=snapQuarter(cyl.value), a=parseInt(axis.value)||0;
  sph.value=formatSigned(s); cyl.value=formatSigned(c);
  if(a<=0) a=180; if(a>180) a=180; axis.value=a;
  let maxVal=Math.abs(s)>Math.abs(s+c)?s:s+c; max.value=formatSigned(maxVal);
}
["od","os"].forEach(e=>["sph-"+e,"cyl-"+e,"axis-"+e].forEach(id=>{
  document.getElementById(id).addEventListener("blur",()=>updateMaxPower(e));
}));

// === Index badges ===
const indexRanges={"1.50":{min:-3,max:2},"1.61":{min:-6,max:4},"1.67":{min:-8,max:5},"1.74":{min:-12,max:7}};
function getMaxPower(){
  const sOD=parseFloat(document.getElementById("sph-od").value)||0,
        cOD=parseFloat(document.getElementById("cyl-od").value)||0,
        sOS=parseFloat(document.getElementById("sph-os").value)||0,
        cOS=parseFloat(document.getElementById("cyl-os").value)||0;
  return Math.max(Math.max(Math.abs(sOD),Math.abs(sOD+cOD)),Math.max(Math.abs(sOS),Math.abs(sOS+cOS)));
}
function updateIndexBadges(){
  let maxPower=getMaxPower();
  Object.keys(indexRanges).forEach(idx=>{
    let r=indexRanges[idx];
    let maxR=Math.max(Math.abs(r.min),Math.abs(r.max));
    let p=Math.round(maxPower/maxR*100); if(p<50) p=50;
    document.getElementById(`badge-${idx}`).innerText = p+"%";
  });
}
["sph-od","cyl-od","sph-os","cyl-os"].forEach(id=>{
  const el=document.getElementById(id);
  el.addEventListener("blur",updateIndexBadges);
  el.addEventListener("input",updateIndexBadges);
});

// === CSV Database (single coating per lens) ===
const csvData=`Brand,Model,Index,Coating,Photochromic,Optical Design,Price,Description
BrandA,ModelX,1.61,Normal UV blocker,Normal,Everyday quality,150,Daily use
BrandB,ModelY,1.67,Normal Blue Light Filter,Extra Dark,Custom Enhanced Optical calculation,220,Office use
BrandC,ModelZ,1.74,Low reflection coating,Normal,Custom Common Optics,200,Low reflection lens
BrandD,ModelW,1.50,Enhance vision in low light,Extra Fast,Everyday quality,180,Enhanced vision lens
`;

// === CSV Parsing ===
function parseCSV(csv){
  const [header, ...lines] = csv.trim().split("\n");
  const keys = header.split(",");
  return lines.map(line=>{
    const values = line.split(",");
    let obj={};
    keys.forEach((key,i)=>obj[key.trim()]=values[i].trim());
    return obj;
  });
}

// === Get multiple selected values for filtering ===
function getSelectedValues(name){
  return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(e=>e.value);
}

// === Populate results table ===
function populateTable(){
  const data = parseCSV(csvData);
  const tbody = document.getElementById("resultsBody");
  tbody.innerHTML = "";
  
  const selectedCoating = getSelectedValues('coat');
  const selectedPhoto = getSelectedValues('photo');
  const selectedDesign = getSelectedValues('design');
  
  data.forEach(item=>{
    // Filter: only include if the item's property matches any of the selected values or no selection
    const coatingMatch = selectedCoating.length===0 || selectedCoating.includes(item.Coating);
    const photoMatch   = selectedPhoto.length===0 || selectedPhoto.includes(item.Photochromic);
    const designMatch  = selectedDesign.length===0 || selectedDesign.includes(item["Optical Design"]);
    
    if(coatingMatch && photoMatch && designMatch){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.Brand}</td>
        <td>${item.Model}</td>
        <td>${item.Index}</td>
        <td>${item.Coating}</td>
        <td>${item.Photochromic}</td>
        <td>${item["Optical Design"]}</td>
        <td>${item.Price}</td>
        <td>${item.Description}</td>
      `;
      tbody.appendChild(tr);
    }
  });
}

document.getElementById("btnShow").addEventListener("click", populateTable);
</script>
